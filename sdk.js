(()=>{var e;!function(e){e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.GET_USER_PROFILE="GET_USER_PROFILE",e.GO_TO_GAME="GO_TO_GAME",e.GET_PLAYER_DATA="GET_PLAYER_DATA",e.SET_PLAYER_DATA="SET_PLAYER_DATA",e.GET_SERVER_TIME="GET_SERVER_TIME",e.GET_METAVERSE_PLAYER_DATA="GET_METAVERSE_PLAYER_DATA",e.SET_METAVERSE_PLAYER_DATA="SET_METAVERSE_PLAYER_DATA",e.GET_METAVERSE_GAME_PLAYER_DATA="GET_METAVERSE_GAME_PLAYER_DATA",e.SET_METAVERSE_GAME_PLAYER_DATA="SET_METAVERSE_GAME_PLAYER_DATA"}(e||(e={}));const t=new Set(Object.values(e));class n{constructor(e){this.parentOrigin=e,this.callbacks=new Map,this.handleResponse=e=>{if(e.origin!==this.parentOrigin||"string"!=typeof e.data)return;let t;try{t=JSON.parse(e.data)}catch(e){return void console.warn("[SDK] Ignoring invalid JSON response")}const n=this.callbacks.get(t.messageId);n&&"WebsiteSDK"===t.source&&t.actionName===n.actionName&&(clearTimeout(n.timer),this.callbacks.delete(t.messageId),t.error?n.reject(new Error(t.error)):n.resolve(t.payload))},window.addEventListener("message",this.handleResponse)}request(e,n,i=5e3){if(!t.has(e))return Promise.reject(new Error(`[SDK] Action "${e}" is not allowed`));const o=`${Date.now()}-${Math.random()}`,s={source:"WelwiseSDK",actionName:e,messageId:o,payload:n},r=JSON.stringify(s);return new Promise(((t,n)=>{const s=window.setTimeout((()=>{this.callbacks.delete(o),n(new Error(`[SDK] "${e}" timed out after ${i}ms`))}),i);this.callbacks.set(o,{resolve:t,reject:n,actionName:e,timer:s}),window.parent.postMessage(r,this.parentOrigin),console.log("[SDK] postMessage sent:",r,this.parentOrigin)}))}}class i{constructor(e){this.channel=e}goToGame(t){return console.log("[SDK] PlatformNavigation.goToGame() called"),this.channel.request(e.GO_TO_GAME,{gameId:t})}}var o=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class s{constructor(e){this.channel=e}getData(){return o(this,void 0,void 0,(function*(){return console.log("[SDK] player.getData() called"),this.channel.request(e.GET_PLAYER_DATA)}))}setData(t){return o(this,void 0,void 0,(function*(){return console.log("[SDK] player.setData() called",t),this.channel.request(e.SET_PLAYER_DATA,t)}))}}class r{constructor(){const e=window.parent;if(!e.AppEnvironment)throw new Error("[SDK] Environment data is not defined");this.env=e.AppEnvironment}get PlayerId(){return this.env.playerId}get DeviceType(){return this.env.deviceType}get LanguageCode(){return this.env.language}}var a=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};class c{constructor(e){this.channel=e}getData(){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.getData() called"),this.channel.request(e.GET_METAVERSE_PLAYER_DATA)}))}setData(t){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.setData() called",t),this.channel.request(e.SET_METAVERSE_PLAYER_DATA,t)}))}getGameData(){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.getGameData() called"),this.channel.request(e.GET_METAVERSE_GAME_PLAYER_DATA)}))}setGameData(t){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.setGameData() called",t),this.channel.request(e.SET_METAVERSE_GAME_PLAYER_DATA,t)}))}}class u{constructor(e,t){this.parentOrigin=e,this.channel=new n(this.parentOrigin),this.features=t,this.PlatformNavigation=new i(this.channel),this.player=new s(this.channel),this.metaversePlayer=new c(this.channel),this.Environment=new r}serverTime(){return t=this,i=function*(){return console.log("[SDK] pause() called"),this.channel.request(e.GET_SERVER_TIME)},new((n=void 0)||(n=Promise))((function(e,o){function s(e){try{a(i.next(e))}catch(e){o(e)}}function r(e){try{a(i.throw(e))}catch(e){o(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(s,r)}a((i=i.apply(t,[])).next())}));var t,n,i}isMetaverseSupported(){return!!this.features.metaverse}}class l{constructor(){throw new Error("[SDK] Use WelwiseGames.init() instead of constructor")}static init(){return e=this,n=function*(){if(console.log("[SDK] init() called"),l.instance)return console.warn("[SDK] init(): SDK already was initializated"),l.instance;const{hasParent:e,parentOrigin:t,features:n}=yield function(){return e=this,n=function*(){return console.log("[SDK] Starting handshake with parent frame"),window.parent&&window.parent!==window?new Promise((e=>{const t=Date.now();let n=!1;const i=`${Date.now()}-${Math.random()}`;console.log(`[SDK] Sending handshake request, messageId=${i}`);const o=r=>{var a,c;if("string"!=typeof r.data)return void console.warn("[SDK] Ignoring message: not a string");let u;try{u=JSON.parse(r.data)}catch(e){return void console.warn("[SDK] Ignoring message: invalid JSON")}if("WebsiteSDK"!==u.source||"GET_IFRAME_ORIGIN_SRC"!==u.actionName||u.messageId!==i)return void console.warn("[SDK] Ignoring message: unexpected fields",`source=${u.source}, actionName=${u.actionName}, messageId=${u.messageId}`);const l=Date.now()-t;console.log(`[SDK] âœ… Handshake response received in ${l} ms, payload.origin=`,null===(a=u.payload)||void 0===a?void 0:a.origin),n=!0,window.removeEventListener("message",o),clearTimeout(s);const d="string"==typeof(null===(c=u.payload)||void 0===c?void 0:c.origin)?u.payload.origin:null,h="object"==typeof u.payload.features&&null!==u.payload.features?u.payload.features:{};e({hasParent:!0,parentOrigin:d,features:h})};window.addEventListener("message",o),window.parent.postMessage(JSON.stringify({source:"WelwiseSDK",actionName:"GET_IFRAME_ORIGIN_SRC",messageId:i}),"*");const s=setTimeout((()=>{n||(console.warn("[SDK] Parent frame did not respond to handshake within timeout"),window.removeEventListener("message",o),e({hasParent:!0,parentOrigin:null,features:{}}))}),1e3)})):(console.log("[SDK] No parent frame found: communication disabled"),{hasParent:!1,parentOrigin:null,features:{}})},new((t=void 0)||(t=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function r(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,r)}a((n=n.apply(e,[])).next())}));var e,t,n}();if(!e||!t)throw console.error("[SDK] Handshake failed: SDK unavailable"),new Error("[SDK] Handshake with parent frame failed. SDK unavailable.");return console.log("[SDK] Handshake successful: Creating API wrapper"),l.instance=new u(t,n),console.log("[SDK] Initialization complete"),l.instance},new((t=void 0)||(t=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function r(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,r)}a((n=n.apply(e,[])).next())}));var e,t,n}}l.instance=null,window.WelwiseGames=l})();