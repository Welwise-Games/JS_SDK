(()=>{var n;!function(n){n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.GET_USER_PROFILE="GET_USER_PROFILE",n.GO_TO_GAME="GO_TO_GAME",n.GET_PLAYER_DATA="GET_PLAYER_DATA",n.SET_PLAYER_DATA="SET_PLAYER_DATA",n.GET_SERVER_TIME="GET_SERVER_TIME"}(n||(n={}));const e=new Set(Object.values(n));class t{constructor(n){this.parentOrigin=n,this.callbacks=new Map,this.handleResponse=n=>{if(n.origin!==this.parentOrigin||"string"!=typeof n.data)return;let e;try{e=JSON.parse(n.data)}catch(n){return void console.warn("[SDK] Ignoring invalid JSON response")}const t=this.callbacks.get(e.messageId);t&&"WebsiteSDK"===e.source&&e.actionName===t.actionName&&(clearTimeout(t.timer),this.callbacks.delete(e.messageId),e.error?t.reject(new Error(e.error)):t.resolve(e.payload))},window.addEventListener("message",this.handleResponse)}request(n,t,i=5e3){if(!e.has(n))return Promise.reject(new Error(`[SDK] Action "${n}" is not allowed`));const o=`${Date.now()}-${Math.random()}`,s={source:"WelwiseSDK",actionName:n,messageId:o,payload:t},r=JSON.stringify(s);return new Promise(((e,t)=>{const s=window.setTimeout((()=>{this.callbacks.delete(o),t(new Error(`[SDK] "${n}" timed out after ${i}ms`))}),i);this.callbacks.set(o,{resolve:e,reject:t,actionName:n,timer:s}),window.parent.postMessage(r,this.parentOrigin),console.log("[SDK] postMessage sent:",r,this.parentOrigin)}))}}class i{constructor(n){this.channel=n}goToGame(e){return console.log("[SDK] PlatformNavigation.goToGame() called"),this.channel.request(n.GO_TO_GAME,{gameId:e})}}var o=function(n,e,t,i){return new(t||(t=Promise))((function(o,s){function r(n){try{c(i.next(n))}catch(n){s(n)}}function a(n){try{c(i.throw(n))}catch(n){s(n)}}function c(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(r,a)}c((i=i.apply(n,e||[])).next())}))};class s{constructor(n){this.channel=n}getData(){return o(this,void 0,void 0,(function*(){return console.log("[SDK] player.getData() called"),this.channel.request(n.GET_PLAYER_DATA)}))}setData(e){return o(this,void 0,void 0,(function*(){return console.log("[SDK] player.setData() called",e),this.channel.request(n.SET_PLAYER_DATA,e)}))}}class r{constructor(){const n=window.parent;if(!n.AppEnvironment)throw new Error("[SDK] Environment data is not defined");this.env=n.AppEnvironment}get PlayerId(){return this.env.playerId}get DeviceType(){return this.env.deviceType}get LanguageCode(){return this.env.language}}class a{constructor(n){this.parentOrigin=n,this.channel=new t(this.parentOrigin),this.PlatformNavigation=new i(this.channel),this.player=new s(this.channel),this.Environment=new r}serverTime(){return e=this,i=function*(){return console.log("[SDK] pause() called"),this.channel.request(n.GET_SERVER_TIME)},new((t=void 0)||(t=Promise))((function(n,o){function s(n){try{a(i.next(n))}catch(n){o(n)}}function r(n){try{a(i.throw(n))}catch(n){o(n)}}function a(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t((function(n){n(i)}))).then(s,r)}a((i=i.apply(e,[])).next())}));var e,t,i}}class c{constructor(){throw new Error("[SDK] Use WelwiseGames.init() instead of constructor")}static init(){return n=this,t=function*(){if(console.log("[SDK] init() called"),c.instance)return console.warn("[SDK] init(): SDK already was initializated"),c.instance;const{hasParent:n,parentOrigin:e}=yield function(){return n=this,t=function*(){return console.log("[SDK] Starting handshake with parent frame"),window.parent&&window.parent!==window?new Promise((n=>{const e=Date.now();let t=!1;const i=`${Date.now()}-${Math.random()}`;console.log(`[SDK] Sending handshake request, messageId=${i}`);const o=r=>{var a,c;if("string"!=typeof r.data)return void console.warn("[SDK] Ignoring message: not a string");let u;try{u=JSON.parse(r.data)}catch(n){return void console.warn("[SDK] Ignoring message: invalid JSON")}if("WebsiteSDK"!==u.source||"GET_IFRAME_ORIGIN_SRC"!==u.actionName||u.messageId!==i)return void console.warn("[SDK] Ignoring message: unexpected fields",`source=${u.source}, actionName=${u.actionName}, messageId=${u.messageId}`);const l=Date.now()-e;console.log(`[SDK] âœ… Handshake response received in ${l} ms, payload.origin=`,null===(a=u.payload)||void 0===a?void 0:a.origin),t=!0,window.removeEventListener("message",o),clearTimeout(s);const d="string"==typeof(null===(c=u.payload)||void 0===c?void 0:c.origin)?u.payload.origin:null;n({hasParent:!0,parentOrigin:d})};window.addEventListener("message",o),window.parent.postMessage(JSON.stringify({source:"WelwiseSDK",actionName:"GET_IFRAME_ORIGIN_SRC",messageId:i}),"*");const s=setTimeout((()=>{t||(console.warn("[SDK] Parent frame did not respond to handshake within timeout"),window.removeEventListener("message",o),n({hasParent:!0,parentOrigin:null}))}),500)})):(console.log("[SDK] No parent frame found: communication disabled"),{hasParent:!1,parentOrigin:null})},new((e=void 0)||(e=Promise))((function(i,o){function s(n){try{a(t.next(n))}catch(n){o(n)}}function r(n){try{a(t.throw(n))}catch(n){o(n)}}function a(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(s,r)}a((t=t.apply(n,[])).next())}));var n,e,t}();if(!n||!e)throw console.error("[SDK] Handshake failed: SDK unavailable"),new Error("[SDK] Handshake with parent frame failed. SDK unavailable.");return console.log("[SDK] Handshake successful: Creating API wrapper"),c.instance=new a(e),console.log("[SDK] Initialization complete"),c.instance},new((e=void 0)||(e=Promise))((function(i,o){function s(n){try{a(t.next(n))}catch(n){o(n)}}function r(n){try{a(t.throw(n))}catch(n){o(n)}}function a(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(s,r)}a((t=t.apply(n,[])).next())}));var n,e,t}}c.instance=null,window.WelwiseGames=c})();