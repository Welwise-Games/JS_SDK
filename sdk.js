(()=>{var t;!function(t){t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.GET_USER_PROFILE="GET_USER_PROFILE",t.GO_TO_GAME="GO_TO_GAME",t.GET_PLAYER_DATA="GET_PLAYER_DATA",t.SET_PLAYER_DATA="SET_PLAYER_DATA",t.GET_SERVER_TIME="GET_SERVER_TIME",t.GET_METAVERSE_PLAYER_DATA="GET_METAVERSE_PLAYER_DATA",t.SET_METAVERSE_PLAYER_DATA="SET_METAVERSE_PLAYER_DATA",t.GET_METAVERSE_GAME_PLAYER_DATA="GET_METAVERSE_GAME_PLAYER_DATA",t.SET_METAVERSE_GAME_PLAYER_DATA="SET_METAVERSE_GAME_PLAYER_DATA",t.ADV_SHOW_MIDGAME="ADV_SHOW_MIDGAME",t.ADV_SHOW_REWARDED="ADV_SHOW_REWARDED"}(t||(t={}));const n=new Set(Object.values(t));class e{constructor(t){this.parentOrigin=t,this.callbacks=new Map,this.listeners=new Map,this.handleResponse=t=>{if(t.origin!==this.parentOrigin||"string"!=typeof t.data)return;let n;try{n=JSON.parse(t.data)}catch(t){return void console.warn("[SDK] Ignoring invalid JSON response")}if(n.messageId&&this.callbacks.has(n.messageId)){const t=this.callbacks.get(n.messageId);if(!t||"WebsiteSDK"!==n.source||n.actionName!==t.actionName)return;return clearTimeout(t.timer),this.callbacks.delete(n.messageId),void(n.error?t.reject(new Error(n.error)):t.resolve(n.payload))}if(n.channel){const t=this.listeners.get(n.channel);t&&t.forEach((t=>{try{t(n.payload)}catch(t){console.error("[SDK] Error in external message handler",t)}}))}},window.addEventListener("message",this.handleResponse)}request(t,e,i=5e3){if(!n.has(t))return Promise.reject(new Error(`[SDK] Action "${t}" is not allowed`));const r=`${Date.now()}-${Math.random()}`,o={source:"WelwiseSDK",actionName:t,messageId:r,payload:e},s=JSON.stringify(o);return new Promise(((n,e)=>{const o=window.setTimeout((()=>{this.callbacks.delete(r),e(new Error(`[SDK] "${t}" timed out after ${i}ms`))}),i);this.callbacks.set(r,{resolve:n,reject:e,actionName:t,timer:o}),window.parent.postMessage(s,this.parentOrigin)}))}onExternalMessage(t,n){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(n)}}class i{constructor(t){this.channel=t}goToGame(n){return this.channel.request(t.GO_TO_GAME,{gameId:n})}}var r=function(t,n,e,i){return new(e||(e=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}))};class o{constructor(t){this.channel=t}getData(){return r(this,void 0,void 0,(function*(){return this.channel.request(t.GET_PLAYER_DATA)}))}setData(n){return r(this,void 0,void 0,(function*(){return this.channel.request(t.SET_PLAYER_DATA,n)}))}}class s{constructor(){const t=window.parent;if(!t.AppEnvironment)throw new Error("[SDK] Environment data is not defined");this.env=t.AppEnvironment}get PlayerId(){return this.env.playerId}get DeviceType(){return this.env.deviceType}get LanguageCode(){return this.env.language}}var a,c=function(t,n,e,i){return new(e||(e=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}))};class h{constructor(t){this.channel=t}getData(){return c(this,void 0,void 0,(function*(){return this.channel.request(t.GET_METAVERSE_PLAYER_DATA)}))}setData(n){return c(this,void 0,void 0,(function*(){return this.channel.request(t.SET_METAVERSE_PLAYER_DATA,n)}))}getGameData(){return c(this,void 0,void 0,(function*(){return this.channel.request(t.GET_METAVERSE_GAME_PLAYER_DATA)}))}setGameData(n){return c(this,void 0,void 0,(function*(){return this.channel.request(t.SET_METAVERSE_GAME_PLAYER_DATA,n)}))}}!function(t){t[t.Opened=0]="Opened",t[t.Rewarded=1]="Rewarded",t[t.Closed=2]="Closed"}(a||(a={}));class u{constructor(t){this.channel=t,this.callbacks={},this.rewardedState=a.Closed,this.adInProgress=!1,this.onAdvManagerExternalMessage=t=>{var n,e,i,r,o,s,c,h,u,l,d,w,f,v;const{action:E,data:m}=t;switch(E){case"adv-callback-open":null===(e=(n=this.callbacks).onOpen)||void 0===e||e.call(n);break;case"adv-callback-close":this.adInProgress=!1,null===(r=(i=this.callbacks).onClose)||void 0===r||r.call(i);break;case"adv-callback-error":this.adInProgress=!1,null===(s=(o=this.callbacks).onError)||void 0===s||s.call(o,new Error(m.error.message));break;case"rewarded-video-callback-open":this.rewardedState=a.Opened,null===(h=(c=this.callbacks).onOpen)||void 0===h||h.call(c);break;case"rewarded-video-callback-rewarded":this.rewardedState=a.Rewarded,null===(l=(u=this.callbacks).onRewarded)||void 0===l||l.call(u);break;case"rewarded-video-callback-close":this.adInProgress=!1,this.rewardedState=a.Closed,null===(w=(d=this.callbacks).onClose)||void 0===w||w.call(d);break;case"rewarded-video-callback-error":this.adInProgress=!1,null===(v=(f=this.callbacks).onError)||void 0===v||v.call(f,new Error(m.error.message))}},this.channel.onExternalMessage("adv-manager",this.onAdvManagerExternalMessage)}ensureCallbacksIsValid(t,n){const e=["onClose","onError"];"showRewarded"===t&&e.push("onRewarded");const i=e.filter((t=>!(t in n&&"function"==typeof n[t])));i.length&&console.warn(`Missing callbacks for ${t}: ${i.join(", ")}`)}setCallbacks(t,n){this.callbacks={};for(const e of n){const n=t[e];n&&(this.callbacks[e]=n)}}showMidgame(n={}){if(this.adInProgress)return void console.warn("[SDK] showMidgame called while ad in progress");this.adInProgress=!0;const e=n.callbacks||{};this.ensureCallbacksIsValid("showMidgame",e),this.channel.request(t.ADV_SHOW_MIDGAME).then((t=>{var n,i;if(t.error){const r=new Error(t.error.message);console.warn(r),this.adInProgress=!1,null===(n=e.onError)||void 0===n||n.call(e,r),null===(i=e.onClose)||void 0===i||i.call(e)}else this.setCallbacks(e,["onOpen","onClose","onError"])})).catch((t=>{var n,i;console.error(t),this.adInProgress=!1,null===(n=e.onError)||void 0===n||n.call(e,t),null===(i=e.onClose)||void 0===i||i.call(e)}))}showRewarded(n={}){if(this.adInProgress)return void console.warn("[SDK] showRewarded called while ad in progress");this.adInProgress=!0;const e=n.callbacks||{};this.ensureCallbacksIsValid("showRewarded",e),this.channel.request(t.ADV_SHOW_REWARDED).then((t=>{var n,i;if(t.error){const r=new Error(t.error.message);console.warn(r),this.adInProgress=!1,null===(n=e.onError)||void 0===n||n.call(e,r),null===(i=e.onClose)||void 0===i||i.call(e)}else this.setCallbacks(e,["onOpen","onRewarded","onClose","onError"])})).catch((t=>{var n,i;console.error(t),this.adInProgress=!1,null===(n=e.onError)||void 0===n||n.call(e,t),null===(i=e.onClose)||void 0===i||i.call(e)}))}}class l{constructor(t,n){this.parentOrigin=t,this.channel=new e(this.parentOrigin),this.features=n,this.PlatformNavigation=new i(this.channel),this.player=new o(this.channel),this.metaversePlayer=new h(this.channel),this.AdvManager=new u(this.channel),this.Environment=new s}serverTime(){return n=this,i=function*(){return this.channel.request(t.GET_SERVER_TIME)},new((e=void 0)||(e=Promise))((function(t,r){function o(t){try{a(i.next(t))}catch(t){r(t)}}function s(t){try{a(i.throw(t))}catch(t){r(t)}}function a(n){var i;n.done?t(n.value):(i=n.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,s)}a((i=i.apply(n,[])).next())}));var n,e,i}isMetaverseSupported(){return!!this.features.metaverse}}class d{constructor(){throw new Error("[SDK] Use WelwiseGames.init() instead of constructor")}static init(){return t=this,e=function*(){if(d.instance)return d.instance;const{hasParent:t,parentOrigin:n,features:e}=yield function(){return t=this,e=function*(){return window.parent&&window.parent!==window?new Promise((t=>{Date.now();let n=!1;const e=`${Date.now()}-${Math.random()}`,i=o=>{var s;if("string"!=typeof o.data)return;let a;try{a=JSON.parse(o.data)}catch(t){return}if("WebsiteSDK"!==a.source||"GET_IFRAME_ORIGIN_SRC"!==a.actionName||a.messageId!==e)return;Date.now(),n=!0,window.removeEventListener("message",i),clearTimeout(r);const c="string"==typeof(null===(s=a.payload)||void 0===s?void 0:s.origin)?a.payload.origin:null,h="object"==typeof a.payload.features&&null!==a.payload.features?a.payload.features:{};t({hasParent:!0,parentOrigin:c,features:h})};window.addEventListener("message",i),window.parent.postMessage(JSON.stringify({source:"WelwiseSDK",actionName:"GET_IFRAME_ORIGIN_SRC",messageId:e}),"*");const r=setTimeout((()=>{n||(window.removeEventListener("message",i),t({hasParent:!0,parentOrigin:null,features:{}}))}),3e3)})):(console.log("[SDK] No parent frame found: communication disabled"),{hasParent:!1,parentOrigin:null,features:{}})},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{a(e.next(t))}catch(t){r(t)}}function s(t){try{a(e.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}a((e=e.apply(t,[])).next())}));var t,n,e}();if(!t||!n)throw new Error("[SDK] Handshake with parent frame failed. SDK unavailable.");return d.instance=new l(n,e),console.log("[SDK] Initialization complete"),d.instance},new((n=void 0)||(n=Promise))((function(i,r){function o(t){try{a(e.next(t))}catch(t){r(t)}}function s(t){try{a(e.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}a((e=e.apply(t,[])).next())}));var t,n,e}}d.instance=null,window.WelwiseGames=d})();