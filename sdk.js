(()=>{var t;!function(t){t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.GET_USER_PROFILE="GET_USER_PROFILE",t.GO_TO_GAME="GO_TO_GAME",t.GET_PLAYER_DATA="GET_PLAYER_DATA",t.SET_PLAYER_DATA="SET_PLAYER_DATA",t.GET_SERVER_TIME="GET_SERVER_TIME",t.GET_METAVERSE_PLAYER_DATA="GET_METAVERSE_PLAYER_DATA",t.SET_METAVERSE_PLAYER_DATA="SET_METAVERSE_PLAYER_DATA",t.GET_METAVERSE_GAME_PLAYER_DATA="GET_METAVERSE_GAME_PLAYER_DATA",t.SET_METAVERSE_GAME_PLAYER_DATA="SET_METAVERSE_GAME_PLAYER_DATA"}(t||(t={}));const e=new Set(Object.values(t));class n{constructor(t){this.parentOrigin=t,this.callbacks=new Map,this.handleResponse=t=>{if(t.origin!==this.parentOrigin||"string"!=typeof t.data)return;let e;try{e=JSON.parse(t.data)}catch(t){return void console.warn("[SDK] Ignoring invalid JSON response")}const n=this.callbacks.get(e.messageId);n&&"WebsiteSDK"===e.source&&e.actionName===n.actionName&&(clearTimeout(n.timer),this.callbacks.delete(e.messageId),e.error?n.reject(new Error(e.error)):n.resolve(e.payload))},window.addEventListener("message",this.handleResponse)}request(t,n,i=5e3){if(!e.has(t))return Promise.reject(new Error(`[SDK] Action "${t}" is not allowed`));const o=`${Date.now()}-${Math.random()}`,s={source:"WelwiseSDK",actionName:t,messageId:o,payload:n},r=JSON.stringify(s);return new Promise(((e,n)=>{const s=window.setTimeout((()=>{this.callbacks.delete(o),n(new Error(`[SDK] "${t}" timed out after ${i}ms`))}),i);this.callbacks.set(o,{resolve:e,reject:n,actionName:t,timer:s}),window.parent.postMessage(r,this.parentOrigin),console.log("[SDK] postMessage sent:",r,this.parentOrigin)}))}}class i{constructor(t){this.channel=t}goToGame(e){return console.log("[SDK] PlatformNavigation.goToGame() called"),this.channel.request(t.GO_TO_GAME,{gameId:e})}}var o=function(t,e,n,i){return new(n||(n=Promise))((function(o,s){function r(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((i=i.apply(t,e||[])).next())}))};class s{constructor(t){this.channel=t}getData(){return o(this,void 0,void 0,(function*(){return console.log("[SDK] player.getData() called"),this.channel.request(t.GET_PLAYER_DATA)}))}setData(e){return o(this,void 0,void 0,(function*(){return console.log("[SDK] player.setData() called",e),this.channel.request(t.SET_PLAYER_DATA,e)}))}}class r{constructor(){const t=window.parent;if(!t.AppEnvironment)throw new Error("[SDK] Environment data is not defined");this.env=t.AppEnvironment}get PlayerId(){return this.env.playerId}get DeviceType(){return this.env.deviceType}get LanguageCode(){return this.env.language}}var a=function(t,e,n,i){return new(n||(n=Promise))((function(o,s){function r(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((i=i.apply(t,e||[])).next())}))};class c{constructor(t){this.channel=t}getData(){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.getData() called"),this.channel.request(t.GET_METAVERSE_PLAYER_DATA)}))}setData(e){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.setData() called",e),this.channel.request(t.SET_METAVERSE_PLAYER_DATA,e)}))}getGameData(){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.getGameData() called"),this.channel.request(t.GET_METAVERSE_GAME_PLAYER_DATA)}))}setGameData(e){return a(this,void 0,void 0,(function*(){return console.log("[SDK] metaversePlayer.setGameData() called",e),this.channel.request(t.SET_METAVERSE_GAME_PLAYER_DATA,e)}))}}class u{constructor(t){this.parentOrigin=t,this.channel=new n(this.parentOrigin),this.PlatformNavigation=new i(this.channel),this.player=new s(this.channel),this.metaversePlayer=new c(this.channel),this.Environment=new r}serverTime(){return e=this,i=function*(){return console.log("[SDK] pause() called"),this.channel.request(t.GET_SERVER_TIME)},new((n=void 0)||(n=Promise))((function(t,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function r(t){try{a(i.throw(t))}catch(t){o(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof n?i:new n((function(t){t(i)}))).then(s,r)}a((i=i.apply(e,[])).next())}));var e,n,i}}class l{constructor(){throw new Error("[SDK] Use WelwiseGames.init() instead of constructor")}static init(){return t=this,n=function*(){if(console.log("[SDK] init() called"),l.instance)return console.warn("[SDK] init(): SDK already was initializated"),l.instance;const{hasParent:t,parentOrigin:e}=yield function(){return t=this,n=function*(){return console.log("[SDK] Starting handshake with parent frame"),window.parent&&window.parent!==window?new Promise((t=>{const e=Date.now();let n=!1;const i=`${Date.now()}-${Math.random()}`;console.log(`[SDK] Sending handshake request, messageId=${i}`);const o=r=>{var a,c;if("string"!=typeof r.data)return void console.warn("[SDK] Ignoring message: not a string");let u;try{u=JSON.parse(r.data)}catch(t){return void console.warn("[SDK] Ignoring message: invalid JSON")}if("WebsiteSDK"!==u.source||"GET_IFRAME_ORIGIN_SRC"!==u.actionName||u.messageId!==i)return void console.warn("[SDK] Ignoring message: unexpected fields",`source=${u.source}, actionName=${u.actionName}, messageId=${u.messageId}`);const l=Date.now()-e;console.log(`[SDK] âœ… Handshake response received in ${l} ms, payload.origin=`,null===(a=u.payload)||void 0===a?void 0:a.origin),n=!0,window.removeEventListener("message",o),clearTimeout(s);const d="string"==typeof(null===(c=u.payload)||void 0===c?void 0:c.origin)?u.payload.origin:null;t({hasParent:!0,parentOrigin:d})};window.addEventListener("message",o),window.parent.postMessage(JSON.stringify({source:"WelwiseSDK",actionName:"GET_IFRAME_ORIGIN_SRC",messageId:i}),"*");const s=setTimeout((()=>{n||(console.warn("[SDK] Parent frame did not respond to handshake within timeout"),window.removeEventListener("message",o),t({hasParent:!0,parentOrigin:null}))}),500)})):(console.log("[SDK] No parent frame found: communication disabled"),{hasParent:!1,parentOrigin:null})},new((e=void 0)||(e=Promise))((function(i,o){function s(t){try{a(n.next(t))}catch(t){o(t)}}function r(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,r)}a((n=n.apply(t,[])).next())}));var t,e,n}();if(!t||!e)throw console.error("[SDK] Handshake failed: SDK unavailable"),new Error("[SDK] Handshake with parent frame failed. SDK unavailable.");return console.log("[SDK] Handshake successful: Creating API wrapper"),l.instance=new u(e),console.log("[SDK] Initialization complete"),l.instance},new((e=void 0)||(e=Promise))((function(i,o){function s(t){try{a(n.next(t))}catch(t){o(t)}}function r(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,r)}a((n=n.apply(t,[])).next())}));var t,e,n}}l.instance=null,window.WelwiseGames=l})();